<!DOCTYPE html>
<html>
<head>
    <title>åŠ³åŠ¡å°åŠ©æ‰‹</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* æ ·å¼ä¿æŒä¸å˜ */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        button.logout {
            background-color: #f44336;
        }
        button.logout:hover {
            background-color: #da190b;
        }
        .info-display {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .info-display p {
            margin: 10px 0;
        }
        .error {
            color: red;
            margin: 10px 0;
        }
        .success {
            color: green;
            margin: 10px 0;
        }
        .hidden {
            display: none !important;  /* åŠ  !important æé«˜ä¼˜å…ˆçº§ */
        }
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 4px 4px 0 0;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            color: black;
        }
        .tab button:hover {
            background-color: #ddd;
        }
        .tab button.active {
            background-color: #4CAF50;
            color: white;
        }
        /* ç¡®ä¿ tabcontent æœ‰æ­£ç¡®çš„é«˜åº¦ */
        .tabcontent {
            display: none;  /* é»˜è®¤éšè—ï¼Œä½†åˆ‡æ¢æ—¶ä¼šæ˜¾ç¤º */
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 4px 4px;
            background-color: white;
            height: auto;           /* ç¡®ä¿é«˜åº¦è‡ªåŠ¨ */
            min-height: 200px;      /* ç»™ä¸ªæœ€å°é«˜åº¦ */
            overflow: visible;      /* ç¡®ä¿å†…å®¹å¯è§ */
        }

        /* å½“ tabcontent æ˜¾ç¤ºæ—¶ */
        .tabcontent[style*="display: block"] {
            height: auto;
            min-height: 200px;
        }

        /* ä¿®æ”¹ hidden ç±»ï¼Œä¸è¦å®Œå…¨ä¾èµ–å®ƒ */
        .hidden {
            display: none !important;
        }

        /* ç¡®ä¿æ³¨å†Œè¡¨å•å®¹å™¨æœ‰é«˜åº¦ */
        #Register {
            min-height: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>åŠ³åŠ¡å°åŠ©æ‰‹</h1>
        
        <!-- ç™»å½•/æ³¨å†Œåˆ‡æ¢æ ‡ç­¾ -->
        <div class="tab">
            <button class="tablinks active" onclick="window.openTab(event, 'Login')">ç™»å½•</button>
            <button class="tablinks" onclick="window.openTab(event, 'Register')">æ³¨å†Œ</button>
        </div>

        <!-- ç™»å½•è¡¨å• -->
        <div id="Login" class="tabcontent" style="display: block;">
            <h2>ç™»å½•</h2>
            <div class="form-group">
                <label for="login-email">é‚®ç®±</label>
                <input type="email" id="login-email" placeholder="è¯·è¾“å…¥é‚®ç®±">
            </div>
            <div class="form-group">
                <label for="login-password">å¯†ç </label>
                <input type="password" id="login-password" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <button onclick="window.handleLogin()">ç™»å½•</button>
            <div id="login-error" class="error"></div>
        </div>

        <!-- æ³¨å†Œè¡¨å• -->
        <div id="Register" class="tabcontent" style="min-height: 300px; height: auto; display: none;">
            <h2>æ³¨å†Œ</h2>
            <div class="form-group">
                <label for="register-name">å§“å</label>
                <input type="text" id="register-name" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            <div class="form-group">
                <label for="register-email">é‚®ç®±</label>
                <input type="email" id="register-email" placeholder="è¯·è¾“å…¥é‚®ç®±">
            </div>
            <div class="form-group">
                <label for="register-password">å¯†ç </label>
                <input type="password" id="register-password" placeholder="è¯·è¾“å…¥å¯†ç ">
            </div>
            <button onclick="window.handleRegister()">æ³¨å†Œ</button>
            <div id="register-error" class="error"></div>
            <div id="register-success" class="success"></div>
        </div>

        <!-- åŠŸèƒ½é€‰æ‹©ç•Œé¢ï¼ˆç™»å½•åé¦–å…ˆæ˜¾ç¤ºï¼‰ -->
        <div id="function-select-section" class="hidden">
            <h2>æ¬¢è¿æ‚¨ï¼Œ<span id="welcome-name"></span></h2>
            <p>è¯·é€‰æ‹©è¦æ“ä½œçš„åŠŸèƒ½ï¼š</p>
            
            <div style="display: flex; gap: 20px; margin-top: 30px;">
                <div style="flex: 1; padding: 20px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; background-color: #f9f9f9;" onclick="window.showPersonalInfo()">
                    <h3>ğŸ“‹ ä¸ªäººä¿¡æ¯æ ¸å¯¹</h3>
                    <p>æŸ¥çœ‹/ç¼–è¾‘æ‚¨çš„ä¸ªäººèµ„æ–™</p>
                </div>
                
                <div style="flex: 1; padding: 20px; border: 1px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; background-color: #f9f9f9;" onclick="window.showWageQuery()">
                    <h3>ğŸ’° é›‡å·¥è´¹ç”¨æŸ¥è¯¢</h3>
                    <p>æŸ¥çœ‹å³æ—¶å·¥é’±</p>
                </div>
            </div>
            
            <button class="logout" style="margin-top: 30px;" onclick="window.handleLogout()">é€€å‡ºç™»å½•</button>
        </div>

        <!-- é›‡å·¥è´¹ç”¨æŸ¥è¯¢ç•Œé¢ -->
        <div id="wage-query-section" class="hidden">
            <h2>é›‡å·¥è´¹ç”¨æŸ¥è¯¢</h2>
            
            <div class="info-display">
                <p>è¿‘æœŸå·¥é’±è®°å½•ï¼š</p>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background-color: #f2f2f2;">
                            <th style="padding: 8px; border: 1px solid #ddd;">æ—¥æœŸ</th>
                            <th style="padding: 8px; border: 1px solid #ddd;">é¡¹ç›®</th>
                            <th style="padding: 8px; border: 1px solid #ddd;">å·¥æ—¶</th>
                            <th style="padding: 8px; border: 1px solid #ddd;">å·¥é’±</th>
                        </tr>
                    </thead>
                    <tbody id="wage-records">
                        <tr>
                            <td style="padding: 8px; border: 1px solid #ddd;" colspan="4">æš‚æ— è®°å½•</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <button onclick="window.backToFunctionSelect()">è¿”å›åŠŸèƒ½é€‰æ‹©</button>
            <button class="logout" onclick="window.handleLogout()">é€€å‡ºç™»å½•</button>
        </div>

        <!-- ä¸ªäººä¿¡æ¯æ˜¾ç¤º/ç¼–è¾‘åŒºï¼ˆç™»å½•åæ˜¾ç¤ºï¼‰ -->
        <div id="profile-section" class="hidden">
            <h2>æˆ‘çš„ä¿¡æ¯</h2>
            <div id="info-display" class="info-display">
                <p><strong>å§“åï¼š</strong> <span id="display-name"></span></p>
                <p><strong>èº«ä»½è¯å·ï¼š</strong> <span id="display-ID-number"></span></p>
                <p><strong>ç”µè¯ï¼š</strong> <span id="display-phone"></span></p>
                <p><strong>é“¶è¡Œå¡å¼€æˆ·è¡Œï¼š</strong> <span id="display-bank-of-deposit"></span></p>
                <p><strong>é“¶è¡Œå¡å¡å·ï¼š</strong> <span id="display-bank-card-number"></span></p>
            </div>
            <button onclick="window.enableEditMode()">ç¼–è¾‘ä¿¡æ¯</button>
            <button onclick="window.backToFunctionSelect()">è¿”å›åŠŸèƒ½é€‰æ‹©</button>  <!-- æ–°å¢è¿”å›æŒ‰é’® -->
            <button class="logout" onclick="window.handleLogout()">é€€å‡ºç™»å½•</button>
        </div>

        <!-- ç¼–è¾‘ä¿¡æ¯è¡¨å•ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰ -->
        <div id="edit-section" class="hidden">
            <h2>ç¼–è¾‘ä¸ªäººä¿¡æ¯</h2>
            <div class="form-group">
                <label for="edit-name">å§“å</label>
                <input type="text" id="edit-name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
            </div>
            <div class="form-group">
                <label for="edit-ID-number">èº«ä»½è¯å·</label>
                <input type="text" id="edit-ID-number" placeholder="è¯·è¾“å…¥æ‚¨çš„èº«ä»½è¯å·">
            </div>
            <div class="form-group">
                <label for="edit-phone">ç”µè¯</label>
                <input type="tel" id="edit-phone" placeholder="è¯·è¾“å…¥æ‚¨çš„ç”µè¯å·ç ">
            </div>
            <div class="form-group">
                <label for="edit-bank-of-deposit">é“¶è¡Œå¡å¼€æˆ·è¡Œ</label>
                <input type="text" id="edit-bank-of-deposit" placeholder="è¯·è¾“å…¥æ‚¨çš„é“¶è¡Œå¡å¼€æˆ·è¡Œ">
            </div>
            <div class="form-group">
                <label for="edit-bank-card-number">é“¶è¡Œå¡å¡å·</label>
                <input type="text" id="edit-bank-card-number" placeholder="è¯·è¾“å…¥æ‚¨çš„é“¶è¡Œå¡å·">
            </div>
            <button onclick="window.saveProfile()">ä¿å­˜</button>
            <button onclick="window.cancelEdit()">å–æ¶ˆ</button>
            <div id="edit-error" class="error"></div>
        </div>
    </div>

    <script>
        // ===== ä½¿ç”¨ supabaseClient é¿å…å‘½åå†²çª =====
        const supabaseUrl = 'https://qarxxoosknpmthykforf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhcnh4b29za25wbXRoeWtmb3JmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA4NTI2NDgsImV4cCI6MjA4NjQyODY0OH0.NNQUYewxu-hKN6lvfnq-VXmaMPEcF6BLhj-UcArlkCI';
        
        // åˆ›å»º Supabase å®¢æˆ·ç«¯
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        // å½“å‰ç”¨æˆ·çŠ¶æ€
        let currentUser = null;
        let currentProfile = null;

        // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
        supabaseClient.auth.onAuthStateChange((event, session) => {
            if (session) {
                currentUser = session.user;
                loadUserProfile();
            } else {
                currentUser = null;
                currentProfile = null;
                showLoginTabs();
            }
        });

        // æ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€
        checkUser();

        async function checkUser() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (user) {
                currentUser = user;
                loadUserProfile();
            }
        }

        // æ ‡ç­¾åˆ‡æ¢å‡½æ•°
        window.openTab = function(evt, tabName) {
            console.log('åˆ‡æ¢æ ‡ç­¾åˆ°:', tabName);  // æ·»åŠ æ—¥å¿—
            
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                console.log('éšè—:', tabcontent[i].id);  // æ·»åŠ æ—¥å¿—
            }
            
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾
            const selectedTab = document.getElementById(tabName);
            selectedTab.style.display = "block";
            selectedTab.style.height = "auto";
            selectedTab.style.minHeight = "300px";
            selectedTab.classList.remove('hidden');  // ç¡®ä¿ç§»é™¤ hidden ç±»
            console.log('æ˜¾ç¤º:', tabName);
            
            evt.currentTarget.className += " active";
        }

        // ç™»å½•å¤„ç†
        window.handleLogin = async function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');

            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                currentUser = data.user;
                loadUserProfile();
            } catch (error) {
                errorDiv.textContent = error.message;
            }
        }

        // æ³¨å†Œå¤„ç†
        window.handleRegister = async function() {
            console.log('æ³¨å†Œå‡½æ•°è¢«è°ƒç”¨');
    
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const errorDiv = document.getElementById('register-error');
            const successDiv = document.getElementById('register-success');

            console.log('è¾“å…¥å€¼:', { 
                name: name, 
                email: email, 
                password: password,
                emailé•¿åº¦: email.length,
                å¯†ç é•¿åº¦: password.length 
            });
            
            try {
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: { name: name },
                        emailRedirectTo: window.location.origin  // æ·»åŠ é‡å®šå‘
                    }
                });

                if (error) throw error;

                successDiv.textContent = 'æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•ã€‚';
                errorDiv.textContent = '';
                setTimeout(() => {
                    window.openTab(event, 'Login');
                }, 2000);
            } catch (error) {
                errorDiv.textContent = error.message;
            }
        }

        // åŠ è½½ç”¨æˆ·ä¸ªäººä¿¡æ¯
        async function loadUserProfile() {
            if (!currentUser) return;

            try {
                const { data, error } = await supabaseClient
                    .from('Employee_information')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (error) throw error;

                currentProfile = data;
                displayProfile();
            } catch (error) {
                console.error('åŠ è½½ä¸ªäººä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºä¸ªäººä¿¡æ¯
        // ç™»å½•æˆåŠŸåï¼ŒåªåŠ è½½æ•°æ®ï¼Œæ˜¾ç¤ºåŠŸèƒ½é€‰æ‹©ç•Œé¢
        function displayProfile() {
            if (!currentProfile) return;

            // æ›´æ–°æ¬¢è¿ä¿¡æ¯
            document.getElementById('welcome-name').textContent = currentProfile.name || '';
            
            // æ›´æ–°ä¸ªäººä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ
            document.getElementById('display-name').textContent = currentProfile.name || '';
            document.getElementById('display-ID-number').textContent = currentProfile.id_number || '';
            document.getElementById('display-phone').textContent = currentProfile.cell_phone_number || 'æœªå¡«å†™';
            document.getElementById('display-bank-of-deposit').textContent = currentProfile.bank_of_deposit || 'æœªå¡«å†™';
            document.getElementById('display-bank-card-number').textContent = currentProfile.bank_card_number || 'æœªå¡«å†™';
            
            // ==== å¼ºåˆ¶éšè—ç™»å½•æ¡†çš„å¤šç§æ–¹å¼ ====
            // 1. éšè—æ•´ä¸ª tab å®¹å™¨
            document.querySelector('.tab').classList.add('hidden');
            
            // 2. ç›´æ¥éšè—ç™»å½•å’Œæ³¨å†Œçš„ div
            document.getElementById('Login').classList.add('hidden');
            document.getElementById('Register').classList.add('hidden');
            
            // 3. å¼ºåˆ¶è®¾ç½®å†…è”æ ·å¼ï¼ˆæœ€ä¿é™©ï¼‰
            document.querySelector('.tab').style.display = 'none';
            document.getElementById('Login').style.display = 'none';
            document.getElementById('Register').style.display = 'none';
            
            // éšè—å…¶ä»–ç•Œé¢
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('wage-query-section').classList.add('hidden');
            document.getElementById('edit-section').classList.add('hidden');
            
            // æ˜¾ç¤ºåŠŸèƒ½é€‰æ‹©ç•Œé¢
            document.getElementById('function-select-section').classList.remove('hidden');
            document.getElementById('function-select-section').style.display = 'block'; // ç¡®ä¿æ˜¾ç¤º
        }

        // æ˜¾ç¤ºä¸ªäººä¿¡æ¯æ ¸å¯¹ç•Œé¢
        window.showPersonalInfo = function() {
            document.getElementById('function-select-section').classList.add('hidden');
            document.getElementById('wage-query-section').classList.add('hidden');
            document.getElementById('profile-section').classList.remove('hidden');  // æ˜¾ç¤ºä¸ªäººä¿¡æ¯
        }

        // æ˜¾ç¤ºç™»å½•/æ³¨å†Œæ ‡ç­¾
        function showLoginTabs() {
            // æ¢å¤æ˜¾ç¤ºç™»å½•æ¡†
            document.querySelector('.tab').classList.remove('hidden');
            document.querySelector('.tab').style.display = 'block'; // å¼ºåˆ¶æ¢å¤
            
            document.getElementById('Login').classList.remove('hidden');
            document.getElementById('Login').style.display = 'block';
            
            document.getElementById('Register').classList.add('hidden');
            document.getElementById('Register').style.display = 'none';
            
            // éšè—æ‰€æœ‰å…¶ä»–ç•Œé¢
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('profile-section').style.display = 'none';
            
            document.getElementById('edit-section').classList.add('hidden');
            document.getElementById('edit-section').style.display = 'none';
            
            document.getElementById('function-select-section').classList.add('hidden');
            document.getElementById('function-select-section').style.display = 'none';
            
            document.getElementById('wage-query-section').classList.add('hidden');
            document.getElementById('wage-query-section').style.display = 'none';
            
            // é»˜è®¤æ˜¾ç¤ºç™»å½•è¡¨å•
            window.openTab({ currentTarget: document.querySelector('.tablinks') }, 'Login');
        }

        // å¯ç”¨ç¼–è¾‘æ¨¡å¼
        window.enableEditMode = function() {
            if (!currentProfile) return;

            document.getElementById('edit-name').value = currentProfile.name || '';
            document.getElementById('edit-ID-number').value = currentProfile.id_number || '';
            document.getElementById('edit-phone').value = currentProfile.cell_phone_number || '';
            document.getElementById('edit-bank-of-deposit').value = currentProfile.bank_of_deposit || '';
            document.getElementById('edit-bank-card-number').value = currentProfile.bank_card_number || '';
            
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('edit-section').classList.remove('hidden');
        }

        // å–æ¶ˆç¼–è¾‘
        window.cancelEdit = function() {
            document.getElementById('edit-section').classList.add('hidden');
            // ä¿®æ”¹è¿™é‡Œï¼šä»ä¸ªäººä¿¡æ¯ç•Œé¢è¿”å›æ—¶ï¼Œå›åˆ°åŠŸèƒ½é€‰æ‹©ç•Œé¢
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('function-select-section').classList.remove('hidden');
        }

        // ä¿å­˜ä¸ªäººä¿¡æ¯
        window.saveProfile = async function() {
            if (!currentUser) return;

            const errorDiv = document.getElementById('edit-error');
            
            try {
                const updates = {
                    name: document.getElementById('edit-name').value,
                    id_number: document.getElementById('edit-ID-number').value,
                    cell_phone_number: document.getElementById('edit-phone').value,
                    bank_of_deposit: document.getElementById('edit-bank-of-deposit').value,
                    bank_card_number: document.getElementById('edit-bank-card-number').value
                };

                const { error } = await supabaseClient
                    .from('Employee_information')
                    .update(updates)
                    .eq('id', currentUser.id);

                // ä¿å­˜æˆåŠŸåï¼Œå›åˆ°åŠŸèƒ½é€‰æ‹©ç•Œé¢
                if (error) throw error;

                // é‡æ–°åŠ è½½ä¸ªäººä¿¡æ¯
                await loadUserProfile();

                // è¿”å›åŠŸèƒ½é€‰æ‹©ç•Œé¢ï¼ˆè€Œä¸æ˜¯ä¸ªäººä¿¡æ¯ç•Œé¢ï¼‰
                document.getElementById('edit-section').classList.add('hidden');
                document.getElementById('profile-section').classList.add('hidden');
                document.getElementById('function-select-section').classList.remove('hidden');
            } catch (error) {
                errorDiv.textContent = error.message;
            }
        }

        // åŠ è½½ç”¨æˆ·é›‡å·¥è´¹ç”¨
        async function loadUserRecords() {
            // éªŒè¯ç”¨æˆ·ç™»å½•
            if (!currentUser?.id) {
                console.log('ç”¨æˆ·æœªç™»å½•');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            showLoading();
            
            try {
                const { data, error } = await supabaseClient
                    .from('payroll_records')  // ç”¨å°å†™å¤æ•°
                    .select('*')
                    .eq('user_id', currentUser.id)  // ç”¨ user_id è€Œä¸æ˜¯ id
                    .order('created_at', { ascending: false });  // æŒ‰æ—¶é—´å€’åº
                
                if (error) throw error;
                
                // ä¿å­˜æ•°æ®ï¼ˆå¯èƒ½æ˜¯ç©ºæ•°ç»„ï¼‰
                currentRecords = data || [];
                
                if (currentRecords.length > 0) {
                    showWageQuery();
                } else {
                    showEmptyState();  // æ˜¾ç¤º"æš‚æ— è®°å½•"çš„æç¤º
                }
                
            } catch (error) {
                console.error('åŠ è½½é›‡å·¥è´¹ç”¨å¤±è´¥:', error);
                showErrorMessage('åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            } finally {
                hideLoading();  // æ— è®ºå¦‚ä½•éƒ½éšè—åŠ è½½çŠ¶æ€
            }
        }

        // æ˜¾ç¤ºé›‡å·¥è´¹ç”¨æŸ¥è¯¢ç•Œé¢
        window.showWageQuery = function() {
            document.getElementById('function-select-section').classList.add('hidden');
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('wage-query-section').classList.remove('hidden');
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å·¥é’±æ•°æ®çš„åŠ è½½é€»è¾‘
            loadWageData();
        }

        // è¿”å›åŠŸèƒ½é€‰æ‹©ç•Œé¢
        window.backToFunctionSelect = function() {
            document.getElementById('profile-section').classList.add('hidden');
            document.getElementById('wage-query-section').classList.add('hidden');
            document.getElementById('edit-section').classList.add('hidden');
            document.getElementById('function-select-section').classList.remove('hidden');
        }

        // é€€å‡ºç™»å½•
        window.handleLogout = async function() {
            await supabaseClient.auth.signOut();
            showLoginTabs();
        }

        // ===== ç¡®ä¿æ‰€æœ‰å‡½æ•°éƒ½æŒ‚è½½åˆ°å…¨å±€ =====
        window.openTab = openTab;
        window.handleLogin = handleLogin;
        window.handleRegister = handleRegister;
        window.handleLogout = handleLogout;
        window.enableEditMode = enableEditMode;
        window.cancelEdit = cancelEdit;
        window.saveProfile = saveProfile;
        window.showPersonalInfo = showPersonalInfo;
        window.showWageQuery = showWageQuery;
        window.backToFunctionSelect = backToFunctionSelect;

        console.log('æ‰€æœ‰å‡½æ•°å·²æŒ‚è½½ï¼ŒhandleRegister:', typeof window.handleRegister);
    </script>
</body>
</html>